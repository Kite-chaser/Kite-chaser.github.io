
<html>
  <head lang="zh">
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
        <meta content="yes" name="apple-mobile-web-app-capable"/>
        <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
        <meta content="telephone=no" name="format-detection"/>
        <meta name="renderer" content="webkit">
    <title>分层图 | Kite-chaser</title>
<link href="https://Kite-chaser.github.io/styles/main.css" type="text/css" rel="stylesheet"/>
<script type="text/javascript" src="https://Kite-chaser.github.io/media/scripts/jquery.js"></script>
<script type="text/javascript" src="https://Kite-chaser.github.io/media/scripts/basic.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  </head>

  <body>
     <div class="header">
      <div class="logo_title">
		  
        <div class="title animated fadeInDown"><img src="https://Kite-chaser.github.io/images/avatar.png?v=1572262455098"/>

          <h1 title="Kite-chaser" class="weaklink"><a href="/">Kite-chaser</a>

          </h1>

          <div class="navbar weaklink">
            <div class="normal_nav">

<div class="bitcron_nav_container">


  <div class="bitcron_nav">
    <div class="mixed_site_nav_wrap site_nav_wrap">
		
      <ul class="mixed_site_nav site_nav sm sm-base">
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >首页</a>

  </li>
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >归档</a>

  </li>
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >标签</a>

  </li>
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Kite-chaser.github.io/post/guan-yu/" class="selected active current nav__item" >关于</a>

  </li>
 
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Kite-chaser.github.io/post/you-lian/" class="selected active current nav__item" >友链</a>

  </li>
 

      </ul>

      <div class="clear clear_nav_inline_end"></div>

    </div>

  </div>



  <div class="clear clear_nav_end"></div>

</div>

            </div>

            <div class="hamberger"><i class="fa fa-bars"></i>
<i class="fa fa-times"></i>

            </div>

          </div>

        </div>

      </div>

      <div class="hidden_nav animated fadeInDown">

<div class="bitcron_nav_container">


  <div class="bitcron_nav">
    <div class="mixed_site_nav_wrap site_nav_wrap">
      <ul class="mixed_site_nav site_nav sm sm-base">
		  
	
  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >首页</a>

  </li>


  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >归档</a>

  </li>


  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >标签</a>

  </li>


  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Kite-chaser.github.io/post/guan-yu/" class="selected active current nav__item" >关于</a>

  </li>


  <li><a id="d2ef19af68cc211e98f8a0242ac110003" href="https://Kite-chaser.github.io/post/you-lian/" class="selected active current nav__item" >友链</a>

  </li>





      </ul>

      <div class="clear clear_nav_inline_end"></div>

    </div>

  </div>



  <div class="clear clear_nav_end"></div>

</div>

      </div>

    </div>


    <div class="main">
      <div class="main-inner">


<div class="content">






  <div class="post_page" >

<div class="post">
  <div class="post_title sm_margin">
    <h2><a>分层图</a>



    </h2>
  </div>

  <div class="post_details">
    <div class="info"><i class="fa fa-clock-o"></i>
<span class="date_info">2019-10-27</span>
<i class="fa fa-eye"></i>

<span class="date_info"><span id="busuanzi_value_page_pv"></span> Views</span>


<i class="fa fa-bookmark-o"></i>
<span class="tags_info weaklink">
	
	<a href="https://Kite-chaser.github.io/tag/HCOtf_Rpn" class="tag">最短路</a>

	<a href="https://Kite-chaser.github.io/tag/kAfVaekq5" class="tag">分层图</a>

	<a href="https://Kite-chaser.github.io/tag/kCU-ep_Aq" class="tag">笔记</a>

	<a href="https://Kite-chaser.github.io/tag/nQBg2kv-6" class="tag">图论</a>

	<a href="https://Kite-chaser.github.io/tag/BsZO4xN8u" class="tag">OI</a>


</span>


    </div>

  </div>





  <div class="post_content markdown"><p class="md_block">
    <span class="md_line md_line_start md_line_end"><p>黑科技。</p>
<!-- more -->
<h2 id="前言">前言</h2>
<p>分层图就是一种上层可以到达下层，而下层不可以到达上层的图。<br>
其实重要的是一种构图方法。<br>
<img src="https://Kite-chaser.github.io/post-images/1572143056945.png" alt=""><br>
如图，黑色的边就是一层图，蓝色的边就是上层连向下层的图。</p>
<h2 id="eg1">EG1</h2>
<h3 id="p2939-usaco09feb改造路revamping-trails"><a href="https://www.luogu.org/problem/P2939">P2939 [USACO09FEB]改造路Revamping Trails</a></h3>
<h3 id="题目描述">题目描述</h3>
<p>Farmer John dutifully checks on the cows every day. He traverses some of the M (1 &lt;= M &lt;= 50,000) trails conveniently numbered 1..M from pasture 1 all the way out to pasture N (a journey which is always possible for trail maps given in the test data). The N (1 &lt;= N &lt;= 10,000) pastures conveniently numbered 1..N on Farmer John's farm are currently connected by bidirectional dirt trails. Each trail i connects pastures P1_i and P2_i (1 &lt;= P1_i &lt;= N; 1 &lt;= P2_i &lt;= N) and requires T_i (1 &lt;= T_i &lt;= 1,000,000) units of time to traverse.</p>
<p>He wants to revamp some of the trails on his farm to save time on his long journey. Specifically, he will choose K (1 &lt;= K &lt;= 20) trails to turn into highways, which will effectively reduce the trail's traversal time to 0. Help FJ decide which trails to revamp to minimize the resulting time of getting from pasture 1 to N.</p>
<p>TIME LIMIT: 2 seconds</p>
<h3 id="题意翻译">题意翻译</h3>
<p>约翰一共有N)个牧场.由M条布满尘埃的小径连接.小径可 以双向通行.每天早上约翰从牧场1出发到牧场N去给奶牛检查身体.</p>
<p>通过每条小径都需要消耗一定的时间.约翰打算升级其中K条小径，使之成为高 速公路.在高速公路上的通行几乎是瞬间完成的，所以高速公路的通行时间为0.</p>
<p>请帮助约翰决定对哪些小径进行升级，使他每天从1号牧场到第N号牧场所花的时间最短</p>
<h3 id="solve">Solve</h3>
<p>枚举每个边设零，然后跑最短路？k=1可能还可以，但是k&lt;=20，直接毙命。<br>
分层图于是闪亮登场。其实这道题还可以用动态规划做，但是在这里我们只讨论分层图（<s>其实是蒟蒻不会啦</s>）<br>
升级k条路径，就分k+1层图。第一层就是原图，每一层图内的点和边权都跟原图一样。但是层与层之间的边的边权为零。上层的u点连向下层的v点，边权为零，就相当于升级了这条小径，经过k层跑最短路到达n点，就相当于经过了已经升级了k条边的最短路。<br>
不一定要升级k条边，所以取每层图的最小代价。</p>
<h4 id="建图">建图</h4>
<pre><code class="language-cpp">for(int i=1;i&lt;=m;i++){
	scanf(&quot;%d%d%d&quot;,&amp;u,&amp;v,&amp;w);
	add(u,v,w);add(v,u,w);
	for(int j=1;j&lt;=k;j++){
		add(u+j*n,v+j*n,w);
		add(v+j*n,u+j*n,w);
		add(u+(j-1)*n,v+j*n,0);
		add(v+(j-1)*n,u+j*n,0);//当然无向图需要双向
	}
}
</code></pre>
<p><strong>tip:分层图重要的是构造图的方法,最短路的话，随便啦。但是还是说一句“SPFA死了”</strong></p>
<h3 id="code">Code</h3>
<pre><code class="language-cpp">#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;cstring&gt;
#include&lt;queue&gt;
#define N 10000000
using namespace std;
int n,m,k,ans;
int u,v,w;
int dis[N];
int head[N],len;
struct note{
	int to,vl,nxt;
}eg[N];
struct node{
	int u,vl;
	bool operator&lt;(const node &amp;a)const{
		return a.vl&lt;vl;
	}
};
priority_queue&lt;node&gt; q;
bool vis[N];
void add(int u,int v,int w){
	len++;
	eg[len].to=v;
	eg[len].vl=w;
	eg[len].nxt=head[u];
	head[u]=len;
}
void dj(){
	memset(dis,0x3f,sizeof(dis));
	dis[1]=0;
	q.push((node){1,0});
	while(!q.empty()){
		int e=q.top().u;
		q.pop();
		if(vis[e]) continue;
		vis[e]=true;
		for(int i=head[e];i;i=eg[i].nxt){
			int v=eg[i].to;
			if(dis[v]&gt;dis[e]+eg[i].vl){
				dis[v]=dis[e]+eg[i].vl;
				if(!vis[v]) q.push((node){v,dis[v]});
			}
		}
	}
}
int main()
{
	scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;k);
	for(int i=1;i&lt;=m;i++){
		scanf(&quot;%d%d%d&quot;,&amp;u,&amp;v,&amp;w);
		add(u,v,w);add(v,u,w);
		for(int j=1;j&lt;=k;j++){
			add(u+j*n,v+j*n,w);
			add(v+j*n,u+j*n,w);
			add(u+(j-1)*n,v+j*n,0);
			add(v+(j-1)*n,u+j*n,0);
		}
	}
	dj();
	ans=dis[n];
	for(int i=1;i&lt;=k;i++) ans=min(ans,dis[n+i*n]);
	printf(&quot;%d&quot;,ans);
	return 0;
}
</code></pre>
<h2 id="后言">后言</h2>
<p>这个方法真的很适合图中优化几次边权然后求最小代价的题。</p>
<h2 id="画外音">画外音</h2>
<p>数据过大的话，分层图可能就GG了。而这个时候就该用其他的方法惹。</p>
<h2 id="相关题目">相关题目</h2>
<p><a href="https://www.luogu.org/problem/P4822">P4822 [BJWC2012]冻结</a><br>
<a href="https://www.luogu.org/problem/P4568">P4568 [JLOI2011]飞行路线</a></p>
<h2 id="关于">关于</h2>
<p>[例图取自]（https://www.luogu.org/blog/xiaohou/fen-ceng-tu）<br>
封面不是啦。</p>
</p>

     <p class="md_block">
    <div class="reward"><div class="reward-button">赏 <span class="reward-code"> <span class="alipay-code"> <img class="alipay-img" src="https://Kite-chaser.github.io/media/images/alipay.png"><b>支付宝扫码打赏</b> </span> <span class="wechat-code"> <img class="wechat-img" src="https://Kite-chaser.github.io/media/images/wechat.png"><b>微信打赏</b> </span> </span></div></div>
</p> 
</div>

</div>



<link href="https://Kite-chaser.github.io/styles/main.css" type="text/css" rel="stylesheet"/>

<div class="doc_comments">

          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '761ba32522ad16d2134b',
    clientSecret: 'd5634ea03ca976d589a06f88c4e9fb23c928e5f9',
    repo: 'Kite-chaser.github.io',
    owner: 'Kite-chaser',
    admin: ['Kite-chaser'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          
			  
          
        
</div>



  </div>
</div>



      </div>




    </div>

   <div class="footer">
<link href="https://Kite-chaser.github.io/styles/main.css" type="text/css" rel="stylesheet"/><div class="site_footer_wrap"><div class="site_footer">

      <div class="mysocials"><div class="my_socials">
		   
			   
    
			   
    
			   
    
			   
    
</div><link href="https://Kite-chaser.github.io/styles/main.css" type="text/css" rel="stylesheet"/>

      </div>

      <div class="copyright">Powered by Gridea
      </div>

</div></div>

    </div>


<style type="text/css">a.back_to_top {
    text-decoration: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    background: #f0f0f0;
    height: 40px;
    width: 40px;
    border-radius: 50%;
    line-height: 36px;
    font-size: 18px;
    text-align: center;
    transition-duration: .5s;
    transition-propety: background-color;
    display: none;
}

a.back_to_top span {
    color: #888;
}

a.back_to_top:hover {
    cursor: pointer;
    background: #dfdfdf;
}

a.back_to_top:hover span {
    color: #555;
}

@media print, screen and (max-width: 580px) {
    .back_to_top {
        display: none !important;
    }
}



</style><a id="back_to_top" href="#" class="back_to_top"><span>△</span>
</a>
<script type="text/javascript" src="https://Kite-chaser.github.io/media/scripts/jquery.js"></script>

<script>$(document).ready((function(_this) {
  return function() {
    var bt;
    bt = $('#back_to_top');
    if ($(document).width() > 480) {
      $(window).scroll(function() {
        var st;
        st = $(window).scrollTop();
        if (st > 30) {
          return bt.css('display', 'block');
        } else {
          return bt.css('display', 'none');
        }
      });
      return bt.click(function() {
        $('body,html').animate({
          scrollTop: 0
        }, 800);
        return false;
      });
    }
  };
})(this));
</script>

</body>

</html>