
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>分层图 | Kite-chaser</title>
<meta name="description" content="This is my blog.">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="shortcut icon" href="https://Kite-chaser.github.io/favicon.ico">
<link rel="stylesheet" href="https://Kite-chaser.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://Kite-chaser.github.io">
        <img class="avatar" src="https://Kite-chaser.github.io/images/avatar.png" alt="" width="32px" height="32px">
      </a>
      <a href="https://Kite-chaser.github.io">
        <h1 class="site-title">Kite-chaser</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="https://Kite-chaser.github.io/post/guan-yu/" class="menu purple-link">
            关于
          </a>
        
      
        
          <a href="https://Kite-chaser.github.io/post/you-lian/" class="menu purple-link">
            友链
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          <h2 class="post-title">分层图</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2019-10-27</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://Kite-chaser.github.io/tag/HCOtf_Rpn">
                    最短路
                    
                      ，
                    
                  </a>
                
                  <a href="https://Kite-chaser.github.io/tag/kAfVaekq5">
                    分层图
                    
                      ，
                    
                  </a>
                
                  <a href="https://Kite-chaser.github.io/tag/kCU-ep_Aq">
                    笔记
                    
                      ，
                    
                  </a>
                
                  <a href="https://Kite-chaser.github.io/tag/nQBg2kv-6">
                    图论
                    
                      ，
                    
                  </a>
                
                  <a href="https://Kite-chaser.github.io/tag/BsZO4xN8u">
                    OI
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p>黑科技。</p>
<!-- more -->
<h2 id="前言">前言</h2>
<p>分层图就是一种上层可以到达下层，而下层不可以到达上层的图。<br>
其实重要的是一种构图方法。<br>
<img src="https://Kite-chaser.github.io/post-images/1572143056945.png" alt=""><br>
如图，黑色的边就是一层图，蓝色的边就是上层连向下层的图。</p>
<h2 id="eg1">EG1</h2>
<h3 id="p2939-usaco09feb改造路revamping-trails"><a href="https://www.luogu.org/problem/P2939">P2939 [USACO09FEB]改造路Revamping Trails</a></h3>
<h3 id="题目描述">题目描述</h3>
<p>Farmer John dutifully checks on the cows every day. He traverses some of the M (1 &lt;= M &lt;= 50,000) trails conveniently numbered 1..M from pasture 1 all the way out to pasture N (a journey which is always possible for trail maps given in the test data). The N (1 &lt;= N &lt;= 10,000) pastures conveniently numbered 1..N on Farmer John's farm are currently connected by bidirectional dirt trails. Each trail i connects pastures P1_i and P2_i (1 &lt;= P1_i &lt;= N; 1 &lt;= P2_i &lt;= N) and requires T_i (1 &lt;= T_i &lt;= 1,000,000) units of time to traverse.</p>
<p>He wants to revamp some of the trails on his farm to save time on his long journey. Specifically, he will choose K (1 &lt;= K &lt;= 20) trails to turn into highways, which will effectively reduce the trail's traversal time to 0. Help FJ decide which trails to revamp to minimize the resulting time of getting from pasture 1 to N.</p>
<p>TIME LIMIT: 2 seconds</p>
<h3 id="题意翻译">题意翻译</h3>
<p>约翰一共有N)个牧场.由M条布满尘埃的小径连接.小径可 以双向通行.每天早上约翰从牧场1出发到牧场N去给奶牛检查身体.</p>
<p>通过每条小径都需要消耗一定的时间.约翰打算升级其中K条小径，使之成为高 速公路.在高速公路上的通行几乎是瞬间完成的，所以高速公路的通行时间为0.</p>
<p>请帮助约翰决定对哪些小径进行升级，使他每天从1号牧场到第N号牧场所花的时间最短</p>
<h3 id="solve">Solve</h3>
<p>枚举每个边设零，然后跑最短路？k=1可能还可以，但是k&lt;=20，直接毙命。<br>
分层图于是闪亮登场。其实这道题还可以用动态规划做，但是在这里我们只讨论分层图（<s>其实是蒟蒻不会啦</s>）<br>
升级k条路径，就分k+1层图。第一层就是原图，每一层图内的点和边权都跟原图一样。但是层与层之间的边的边权为零。上层的u点连向下层的v点，边权为零，就相当于升级了这条小径，经过k层跑最短路到达n点，就相当于经过了已经升级了k条边的最短路。<br>
不一定要升级k条边，所以取每层图的最小代价。</p>
<h4 id="建图">建图</h4>
<pre><code class="language-cpp">for(int i=1;i&lt;=m;i++){
	scanf(&quot;%d%d%d&quot;,&amp;u,&amp;v,&amp;w);
	add(u,v,w);add(v,u,w);
	for(int j=1;j&lt;=k;j++){
		add(u+j*n,v+j*n,w);
		add(v+j*n,u+j*n,w);
		add(u+(j-1)*n,v+j*n,0);
		add(v+(j-1)*n,u+j*n,0);//当然无向图需要双向
	}
}
</code></pre>
<p><strong>tip:分层图重要的是构造图的方法,最短路的话，随便啦。但是还是说一句“SPFA死了”</strong></p>
<h3 id="code">Code</h3>
<pre><code class="language-cpp">#include&lt;iostream&gt;
#include&lt;cstdio&gt;
#include&lt;cstring&gt;
#include&lt;queue&gt;
#define N 10000000
using namespace std;
int n,m,k,ans;
int u,v,w;
int dis[N];
int head[N],len;
struct note{
	int to,vl,nxt;
}eg[N];
struct node{
	int u,vl;
	bool operator&lt;(const node &amp;a)const{
		return a.vl&lt;vl;
	}
};
priority_queue&lt;node&gt; q;
bool vis[N];
void add(int u,int v,int w){
	len++;
	eg[len].to=v;
	eg[len].vl=w;
	eg[len].nxt=head[u];
	head[u]=len;
}
void dj(){
	memset(dis,0x3f,sizeof(dis));
	dis[1]=0;
	q.push((node){1,0});
	while(!q.empty()){
		int e=q.top().u;
		q.pop();
		if(vis[e]) continue;
		vis[e]=true;
		for(int i=head[e];i;i=eg[i].nxt){
			int v=eg[i].to;
			if(dis[v]&gt;dis[e]+eg[i].vl){
				dis[v]=dis[e]+eg[i].vl;
				if(!vis[v]) q.push((node){v,dis[v]});
			}
		}
	}
}
int main()
{
	scanf(&quot;%d%d%d&quot;,&amp;n,&amp;m,&amp;k);
	for(int i=1;i&lt;=m;i++){
		scanf(&quot;%d%d%d&quot;,&amp;u,&amp;v,&amp;w);
		add(u,v,w);add(v,u,w);
		for(int j=1;j&lt;=k;j++){
			add(u+j*n,v+j*n,w);
			add(v+j*n,u+j*n,w);
			add(u+(j-1)*n,v+j*n,0);
			add(v+(j-1)*n,u+j*n,0);
		}
	}
	dj();
	ans=dis[n];
	for(int i=1;i&lt;=k;i++) ans=min(ans,dis[n+i*n]);
	printf(&quot;%d&quot;,ans);
	return 0;
}
</code></pre>
<h2 id="后言">后言</h2>
<p>这个方法真的很适合图中优化几次边权然后求最小代价的题。</p>
<h2 id="相关题目">相关题目</h2>
<p><a href="https://www.luogu.org/problem/P4822">P4822 [BJWC2012]冻结</a><br>
<a href="https://www.luogu.org/problem/P4568">P4568 [JLOI2011]飞行路线</a></p>
<h2 id="关于">关于</h2>
<p>[例图取自]（https://www.luogu.org/blog/xiaohou/fen-ceng-tu）<br>
封面不是啦。</p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://Kite-chaser.github.io/post/p3870-tjoi2009kai-guan">
              <h3 class="post-title">
                下一篇：P3870 [TJOI2009]开关
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">This is my blog.</div>
  Powered by Gridea
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  
  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '761ba32522ad16d2134b',
        clientSecret: 'd5634ea03ca976d589a06f88c4e9fb23c928e5f9',
        repo: 'Kite-chaser.github.io',
        owner: 'Kite-chaser',
        admin: ['Kite-chaser'],
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
